<!doctype html>  
<html lang="en">  
<head>  
  <meta charset="utf-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  <title>Sugar Plate — Indian Café Edition (AI Enhanced)</title>  
  <style>  
    /* Indian café theme */  
    :root{  
      --bg:#fff8f0;
      --card:#fff3e0;
      --accent:#d97706;
      --accent-2:#b45309;
      --text:#3b2f2f;
      --muted:#7b6f6a;
      --rim:#f1e4d6;
      --plate:#ffffff;
      --shadow:rgba(120,72,24,0.15);
      --ok:#16a34a; --low:#facc15; --high:#dc2626;  
    }  
    *{box-sizing:border-box}  
    html,body{height:100%}  
    body{font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;margin:0;background:var(--bg);color:var(--text)}  
    .app{max-width:1200px;margin:28px auto;padding:20px;display:grid;grid-template-columns:380px 1fr;gap:20px}  

    /* Sidebar */  
    .panel{background:var(--card);padding:18px;border-radius:16px;box-shadow:0 12px 28px var(--shadow), inset 0 1px 0 rgba(255,255,255,0.3)}  
    h1{margin:0 0 6px;font-size:22px;letter-spacing:.3px}  
    h2{margin:6px 0 12px;font-size:18px;color:var(--accent-2)}  
    .food-list{display:flex;flex-direction:column;gap:10px;max-height:66vh;overflow:auto;padding-right:6px}  
    .food{display:flex;align-items:center;gap:12px;padding:10px;border-radius:12px;cursor:pointer;border:1px solid rgba(120,72,24,0.12);background:#fffdf8;transition:transform .12s ease, box-shadow .12s ease}  
    .food:hover{transform:translateY(-2px);box-shadow:0 8px 18px var(--shadow)}  
    .food img{width:64px;height:64px;object-fit:cover;border-radius:10px}  
    .food .meta{flex:1}  
    .food .meta b{display:block}  
    .food .meta small{color:var(--muted)}  
    .btn{padding:10px 12px;border-radius:10px;border:0;background:var(--accent);color:#fff;cursor:pointer;font-weight:700;letter-spacing:.2px}  
    .btn:disabled{opacity:.55;cursor:not-allowed;filter:grayscale(0.2)}  

    /* Main */  
    .canvas{display:flex;flex-direction:column;gap:14px}  
    .plate-wrap{position:relative;background:linear-gradient(180deg,#fffaf5,#fff3e5);padding:22px;border-radius:16px;min-height:620px;box-shadow:0 12px 28px var(--shadow)}  

    .info{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:#fff7ed;border-radius:12px;border:1px solid rgba(120,72,24,0.12)}  
    .totals{font-weight:800}  

    .plate-scene{position:relative;display:flex;justify-content:center;align-items:center;min-height:460px}  
    .plate{position:relative;width:480px;height:480px;border-radius:50%;background:radial-gradient(circle at 50% 45%, var(--plate) 0%, #fffdf9 55%, #f7efe5 60%, #efe2d4 62%);box-shadow:0 40px 80px var(--shadow), inset 0 0 0 16px var(--rim), inset 0 0 0 22px #fff;overflow:hidden}  
    .plate:after{content:"";position:absolute;inset:24px;border-radius:50%;box-shadow:inset 0 18px 40px rgba(0,0,0,0.06)}  

    .plate .item{position:absolute;width:92px;height:92px;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#fff;border:1px solid rgba(120,72,24,0.10);box-shadow:0 6px 16px var(--shadow);transform:translate(-50%,-50%) scale(.92);opacity:0;animation:pop .28s ease forwards;cursor:pointer}  
    .plate .item img{max-width:100%;max-height:100%}  

    @keyframes pop{from{opacity:0;transform:translate(-50%,-50%) scale(.8)} to{opacity:1;transform:translate(-50%,-50%) scale(.92)}}  

    .reco{margin-top:10px;background:#fff7ed;padding:14px;border-radius:12px;border:1px solid rgba(0,0,0,0.1)}  
    footer{text-align:center;color:var(--muted);font-size:13px;margin-top:15px}  
  </style>  
</head>  

<body>  
 <div class="app">
    <aside class="panel">
      <h1>☕ Sugar Plate — Indian Café</h1>
      <p style="margin-top:4px;color:var(--muted);font-size:14px">Pick <b>5+ items</b> to unlock AI suggestions. Tap an item on the plate to remove it.</p>
      <h2>Breakfast picks</h2>

      <div class="food-list" id="foodList">

        <!-- Existing items + NEW items with realistic sugars and data-type -->
        <div class="food" data-name="Masala Dosa" data-sugar="1.2" data-type="carb" data-img="https://vismaifood.com/storage/app/uploads/public/8b4/19e/427/thumb__1200_0_0_0_auto.jpg">
          <img src="https://vismaifood.com/storage/app/uploads/public/8b4/19e/427/thumb__1200_0_0_0_auto.jpg">
          <div class="meta"><b>Masala Dosa</b><small>1.2 g sugar</small></div>
        </div>

        <div class="food" data-name="Idli & Sambar" data-sugar="3.5" data-type="carb" data-img="https://vaya.in/recipes/wp-content/uploads/2018/02/Idli-and-Sambar-1.jpg">
          <img src="https://vaya.in/recipes/wp-content/uploads/2018/02/Idli-and-Sambar-1.jpg">
          <div class="meta"><b>Idli & Sambar</b><small>3.5 g sugar</small></div>
        </div>

        <div class="food" data-name="Poha" data-sugar="2.2" data-type="carb" data-img="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQNviqYRu3NUiH3bGBpsTSUxddYW1GIryF4tQ&s">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQNviqYRu3NUiH3bGBpsTSUxddYW1GIryF4tQ&s">
          <div class="meta"><b>Poha</b><small>2.2 g sugar</small></div>
        </div>

        <div class="food" data-name="Paratha" data-sugar="1.0" data-type="carb" data-img="https://www.indianhealthyrecipes.com/wp-content/uploads/2025/08/paratha-recipe.jpg">
          <img src="https://www.indianhealthyrecipes.com/wp-content/uploads/2025/08/paratha-recipe.jpg">
          <div class="meta"><b>Paratha</b><small>1 g sugar</small></div>
        </div>

        <div class="food" data-name="Aloo Puri" data-sugar="3.2" data-type="carb" data-img="https://i0.wp.com/lovelaughmirch.com/wp-content/uploads/2022/03/Instant-Rasewale-Aloo-Puri-4.jpg">
          <img src="https://i0.wp.com/lovelaughmirch.com/wp-content/uploads/2022/03/Instant-Rasewale-Aloo-Puri-4.jpg">
          <div class="meta"><b>Aloo Puri</b><small>3.2 g sugar</small></div>
        </div>

        <div class="food" data-name="Chai (sweet)" data-sugar="10" data-type="beverage" data-img="https://masalaandchai.com/wp-content/uploads/2021/07/Masala-Chai-Featured.jpg">
          <img src="https://masalaandchai.com/wp-content/uploads/2021/07/Masala-Chai-Featured.jpg">
          <div class="meta"><b>Chai (sweet)</b><small>10 g sugar</small></div>
        </div>

        <div class="food" data-name="Upma" data-sugar="2" data-type="carb" data-img="https://simpleindianmeals.com/wp-content/uploads/2014/02/Rava-Upma.jpg">
          <img src="https://simpleindianmeals.com/wp-content/uploads/2014/02/Rava-Upma.jpg">
          <div class="meta"><b>Upma</b><small>2 g sugar</small></div>
        </div>

        <div class="food" data-name="Oats Bowl" data-sugar="0.8" data-type="carb" data-img="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=256&auto=format&fit=crop">
          <img src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=60&w=128&auto=format&fit=crop">
          <div class="meta"><b>Oats Bowl (plain)</b><small>0.8 g sugar</small></div>
        </div>

        <div class="food" data-name="Bread Butter" data-sugar="1.4" data-type="carb" data-img="https://media.istockphoto.com/id/1406277631/photo/healthy-wholemeal-toast-with-butter.jpg?s=612x612&w=0&k=20&c=pq1f_SQ6T7o_SVAKJvRRaZBcXrP72S7HpufImYZOvrc=">
          <img src="https://media.istockphoto.com/id/1406277631/photo/healthy-wholemeal-toast-with-butter.jpg?s=612x612&w=0&k=20&c=pq1f_SQ6T7o_SVAKJvRRaZBcXrP72S7HpufImYZOvrc=">
          <div class="meta"><b>Bread & Butter</b><small>1.4 g sugar</small></div>
        </div>

        <div class="food" data-name="Banana" data-sugar="12" data-type="fruit" data-img="https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?q=80&w=256&auto=format&fit=crop">
          <img src="https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?q=60&w=128&auto=format&fit=crop">
          <div class="meta"><b>Banana</b><small>12 g sugar</small></div>
        </div>

        <div class="food" data-name="Apple" data-sugar="10" data-type="fruit" data-img="https://images.unsplash.com/photo-1567306226416-28f0efdc88ce?q=80&w=256&auto=format&fit=crop">
          <img src="https://images.unsplash.com/photo-1567306226416-28f0efdc88ce?q=60&w=128&auto=format&fit=crop">
          <div class="meta"><b>Apple</b><small>10 g sugar</small></div>
        </div>

        <div class="food" data-name="Suji Halwa" data-sugar="22" data-type="sweet" data-img="https://www.vegrecipesofindia.com/wp-content/uploads/2014/07/suji-halwa-recipe.jpg">
          <img src="https://www.vegrecipesofindia.com/wp-content/uploads/2014/07/suji-halwa-recipe.jpg">
          <div class="meta"><b>Suji Halwa</b><small>22 g sugar</small></div>
        </div>

        <!-- NEW ITEMS START HERE -->

        <div class="food" data-name="Paneer Bhurji" data-sugar="0.6" data-type="protein" data-img="https://www.whiskaffair.com/wp-content/uploads/2021/04/Paneer-Bhurji-2-3-1.jpg">
          <img src="https://www.whiskaffair.com/wp-content/uploads/2021/04/Paneer-Bhurji-2-3-1.jpg">
          <div class="meta"><b>Paneer Bhurji</b><small>~0.6 g sugar (high protein)</small></div>
        </div>

        <div class="food" data-name="Sprouts Salad" data-sugar="1.0" data-type="protein" data-img="https://www.indianhealthyrecipes.com/wp-content/uploads/2022/04/sprouts-salad-recipe.jpg">
          <img src="https://www.indianhealthyrecipes.com/wp-content/uploads/2022/04/sprouts-salad-recipe.jpg">
          <div class="meta"><b>Sprouts Salad</b><small>~1 g sugar (protein + fiber)</small></div>
        </div>

        <div class="food" data-name="Egg Omelette" data-sugar="0.5" data-type="protein" data-img="https://www.incredibleegg.org/wp-content/uploads/2015/06/french-omelet-hero.jpeg">
          <img src="https://www.incredibleegg.org/wp-content/uploads/2015/06/french-omelet-hero.jpeg">
          <div class="meta"><b>Egg Omelette</b><small>~0.5 g sugar (protein)</small></div>
        </div>

        <div class="food" data-name="Besan Chilla" data-sugar="1.5" data-type="protein" data-img="https://static.toiimg.com/thumb/59387461.cms?imgsize=271650&width=800&height=800">
          <img src="https://static.toiimg.com/thumb/59387461.cms?imgsize=271650&width=800&height=800">
          <div class="meta"><b>Besan Chilla</b><small>~1.5 g sugar (protein)</small></div>
        </div>

        <div class="food" data-name="Greek Yogurt (Curd)" data-sugar="4.0" data-type="dairy" data-img="https://www.yummytummyaarthi.com/wp-content/uploads/2023/01/IMG_1016-scaled.jpg">
          <img src="https://www.yummytummyaarthi.com/wp-content/uploads/2023/01/IMG_1016-scaled.jpg">
          <div class="meta"><b>Greek Yogurt (Curd)</b><small>~4 g sugar (lactose)</small></div>
        </div>

        <div class="food" data-name="Glass of Milk" data-sugar="12" data-type="dairy" data-img="https://www.americandairy.com/wp-content/uploads/2016/03/glass-of-milk.jpg">
          <img src="https://www.americandairy.com/wp-content/uploads/2016/03/glass-of-milk.jpg">
          <div class="meta"><b>Glass of Milk</b><small>~12 g sugar (natural lactose)</small></div>
        </div>

        <div class="food" data-name="Peanut Butter (1 tbsp)" data-sugar="3.0" data-type="nuts" data-img="https://www.sharmispassions.com/wp-content/uploads/2016/06/peanut-butter2.jpg">
          <img src="https://www.sharmispassions.com/wp-content/uploads/2016/06/peanut-butter2.jpg">
          <div class="meta"><b>Peanut Butter (1 tbsp)</b><small>~3 g sugar (healthy fat + protein)</small></div>
        </div>

        <div class="food" data-name="Mixed Nuts (handful)" data-sugar="1.8" data-type="nuts" data-img="https://www.hamptonfarms.com/cdn/shop/articles/mixed_nuts_trail_mix__snack.jpg?v=1709044815&width=1600">
          <img src="https://www.hamptonfarms.com/cdn/shop/articles/mixed_nuts_trail_mix__snack.jpg?v=1709044815&width=1600">
          <div class="meta"><b>Mixed Nuts</b><small>~1.8 g sugar (protein & healthy fat)</small></div>
        </div>

        <div class="food" data-name="Fruit Smoothie (milk + fruit)" data-sugar="18" data-type="beverage" data-img="https://lilluna.com/wp-content/uploads/2022/10/fruit-smoothie-resize-14-500x500.jpg">
          <img src="https://lilluna.com/wp-content/uploads/2022/10/fruit-smoothie-resize-14-500x500.jpg">
          <div class="meta"><b>Fruit Smoothie</b><small>~18 g sugar (medium-high)</small></div>
        </div>

        <div class="food" data-name="Egg Bhurji" data-sugar="0.6" data-type="protein" data-img="https://i.ytimg.com/vi/rg7MEW_lI0o/maxresdefault.jpg">
          <img src="https://i.ytimg.com/vi/rg7MEW_lI0o/maxresdefault.jpg">
          <div class="meta"><b>Egg Bhurji</b><small>~0.6 g sugar (protein)</small></div>
        </div>

        <!-- NEW ITEMS END -->

      </div>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn" id="resetBtn" style="background:#eab308;color:#4a2d00">Reset Plate</button>
        <button class="btn" id="recoBtn" disabled title="Pick at least 5 items">AI Recommendations</button>
      </div>
    </aside>

    <main class="canvas panel">
      <div class="plate-wrap">
        <div class="info">
          <div>
            <div style="font-size:14px;color:var(--muted)">Selected items</div>
            <div class="totals" id="totals">Total sugar: 0 g</div>
          </div>
          <div class="controls"></div>
        </div>

        <div class="plate-scene">
          <div class="plate" id="plate" aria-label="Plate where selected foods appear"></div>
        </div>

        <div class="reco" id="recommendations" style="display:none">
          <h3 id="recoTitle">AI Recommendations</h3>
          <div id="recoBody">Pick at least 5 items to unlock recommendations, or click the button once enabled.</div>
        </div>

        <footer>Tip: Edit <code>data-sugar</code> on foods to fine-tune values. Click an item on the plate to remove it.</footer>
      </div>
    </main>
  </div>

  <!-- full-screen alert overlay (appears only when AI button clicked) -->
  <div id="alertOverlay" style="
    position: fixed;
    inset: 0;
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    font-weight: 900;
    color: #ffffff;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
    z-index: 9999;
  ">
    <div id="alertMessage" style="padding:20px;text-align:center;"></div>
  </div>

  <script>
/* -------------------------
   BASIC VARIABLES & ELEMENTS
---------------------------*/
const foodList = document.getElementById('foodList');
const plate = document.getElementById('plate');
const totals = document.getElementById('totals');
const recoBtn = document.getElementById('recoBtn');
const resetBtn = document.getElementById('resetBtn');
const reco = document.getElementById('recommendations');
const recoBody = document.getElementById('recoBody');

let selected = [];

/* -------------------------
   FORMAT
---------------------------*/
function formatG(v){ return v.toFixed(1) + " g"; }

/* -------------------------
   ENABLE/DISABLE AI BUTTON
---------------------------*/
function updateRecoButton(){
  const ok = selected.length >= 5;
  recoBtn.disabled = !ok;
}

/* -------------------------
   ADD FOOD TO PLATE
---------------------------*/
[...foodList.querySelectorAll('.food')].forEach(el=>{
  el.addEventListener('click', ()=>{
    selected.push({
      name: el.dataset.name,
      sugar: parseFloat(el.dataset.sugar),
      type: el.dataset.type,
      img: el.dataset.img
    });
    renderPlate();
  });
});

/* -------------------------
   RENDER PLATE
---------------------------*/
function renderPlate(){
  plate.innerHTML = "";
  selected.forEach((item, idx)=>{
    const box = document.createElement('div');
    box.className = 'item';
    const im = document.createElement('img');
    im.src = item.img;
    box.appendChild(im);
    box.style.left = "50%";
    box.style.top = "50%";
    box.addEventListener('click', ()=>{ selected.splice(idx,1); renderPlate(); });
    plate.appendChild(box);
  });
  arrangeItems();
  updateTotals();
  updateRecoButton();
}

/* -------------------------
   ARRANGE ITEMS IN CIRCLE
---------------------------*/
function arrangeItems(){
  const items = [...plate.querySelectorAll('.item')];
  const R = plate.clientWidth/2 - 80;
  const cx = plate.clientWidth/2, cy = cx;
  const n = items.length;
  items.forEach((el,i)=>{
    const angle = (i/n)*Math.PI*2 - Math.PI/2;
    el.style.left = cx + R*Math.cos(angle)+"px";
    el.style.top  = cy + R*Math.sin(angle)+"px";
  });
}

/* -------------------------
   UPDATE TOTALS
---------------------------*/
function updateScreenColor(total) {
  if (total > 30) {
    // HIGH SUGAR → RED
    document.body.style.background = "#ffdad6";
  }
  else if (total < 5) {
    // LOW SUGAR → YELLOW
    document.body.style.background = "#fff4c2";
  }
  else {
    // PERFECT → GREEN
    document.body.style.background = "#d6ffd6";
  }
}

function updateTotals(){
  const sum = selected.reduce((a,b)=>a + (b.sugar||0), 0);
  totals.textContent = "Total sugar: " + formatG(sum);
  // NO alert here — alerts happen ONLY when AI button is clicked
  // Also update the AI button enabled state
  updateRecoButton();
}



function showSugarAlert(level) {
  const overlay = document.getElementById("alertOverlay");
  const msg = document.getElementById("alertMessage");
  if (!overlay || !msg) return;

  overlay.style.pointerEvents = "auto";

  if (level === "high") {
    overlay.style.background = "rgba(255, 0, 0, 0.92)";
    msg.textContent = "⚠️ HIGH SUGAR! Reduce sweets!";
  } else if (level === "low") {
    overlay.style.background = "rgba(255, 215, 0, 0.92)";
    msg.textContent = "⚠️ LOW SUGAR! Add smart carbs or fruit.";
  } else {
    overlay.style.background = "rgba(0, 180, 0, 0.92)";
    msg.textContent = "✔ PERFECT BALANCE!";
  }

  overlay.style.opacity = "1";

  // hide after 3s and restore pointer-events off
  clearTimeout(overlay._hideTimeout);
  overlay._hideTimeout = setTimeout(() => {
    overlay.style.opacity = "0";
    overlay.style.pointerEvents = "none";
  }, 3000);
}




/* -------------------------
   AI RECOMMENDATION ENGINE
---------------------------*/
function generateAIRecommendations() {
  const total = selected.reduce((a,b)=>a + (b.sugar||0), 0);

  // Count categories (extend types if you add more foods)
  const counts = { sweet:0, fruit:0, carb:0, protein:0, dairy:0, beverage:0, other:0 };
  selected.forEach(i=>{
    const t = (i.type || 'other').toLowerCase();
    if (counts.hasOwnProperty(t)) counts[t]++; else counts.other++;
  });

  // Helper: small randomized phrasing variants
  const phr = {
    remove: ["Consider removing", "Try swapping out", "You could remove"],
    replace: ["Swap for", "Try replacing it with", "Consider a swap: "],
    add: ["Add", "Include", "Consider adding"],
    portion: ["Reduce the portion of", "Have a smaller portion of", "Cut down on"],
    tip: ["Tip:", "Suggestion:", "FYI:"]
  };
  function one(list){ return list[Math.floor(Math.random()*list.length)]; }

  // Build prioritized suggestions
  let suggestions = [];
  let details = [];

  // 1) Immediate alert (visual)
  if (total > 30) {
    showSugarAlert("high");
    suggestions.push("<b>High sugar detected — take immediate steps</b>");
  } else if (total < 5 && total > 0) {
    showSugarAlert("low");
    suggestions.push("<b>Low sugar — add a gentle energy source</b>");
  } else {
    showSugarAlert("perfect");
    suggestions.push("<b>Balanced — looks good</b>");
  }

  // 2) Specific combo detectors & tailored swaps
  // chai + sweet (common high-sugar combo)
  const hasChai = selected.some(s => /chai/i.test(s.name));
  const hasHalwa = selected.some(s => /halwa|suji|mithai|sweet/i.test(s.name));
  if (hasChai && hasHalwa) {
    suggestions.push(`${one(phr.remove)} <b>one sweet item</b> (halwa/sweets) when you're having chai — that combo quickly raises sugar.`);
    details.push(`${one(phr.replace)} <b>chai (no or less sugar)</b> or swap halwa for fruit or low-fat curd.`);
  }

  // Too many sweets overall
  if (counts.sweet >= 2) {
    suggestions.push(`${one(phr.portion)} <b>sweets</b> (limit to 1 serving).`);
    details.push(`${one(phr.replace)} sweets with <b>fresh fruit or unsweetened yogurt</b> for similar satisfaction and better nutrients.`);
  }

  // Too many fruits
  if (counts.fruit >= 2) {
    suggestions.push(`${one(phr.tip)} Multiple fruits together can spike glucose — keep to 1 medium fruit or pair with protein.`);
    details.push(`${one(phr.add)} a protein (e.g., curd, paneer, sprouts) when eating 1+ fruits to stabilize blood sugar.`);
  }

  // Carb-heavy plate
  if (counts.carb >= 4 || (counts.carb >=3 && counts.sweet>0)) {
    suggestions.push(`${one(phr.tip)} Your plate is carb-heavy — add protein and fiber.`);
    details.push(`${one(phr.add)} eggs/curd/sprouts and a small salad for slower digestion and steady energy.`);
  }

  // No protein present
  if (counts.protein === 0) {
    suggestions.push(`${one(phr.add)} some protein (curd, paneer, sprouts or a small omelette) — it reduces blood sugar spikes.`);
    details.push("Protein suggestion: 100 g curd / 50 g paneer / small bowl of sprouts.");
  }

  // Very low sugar
  if (total < 5 && total > 0) {
    suggestions.push(`<b>Energy low:</b> add 1 small banana, 1 slice of bread+butter, or a cup of milk/tea to raise energy gently.`);
    details.push("If you feel dizzy or weak, prefer a quick carb with some protein (milk + banana or bread + peanut butter).");
  }

  // Balanced plate encouragement + portion advice
  if (total >= 5 && total <= 30) {
    suggestions.push("Good balance — keep portions sensible and hydrate.");
    details.push("Small wins: drink water before eating, include fiber (salad/veggies), and avoid adding extra sugar to beverages.");
  }

  // Personalized swap ideas for common items (inspect selected items)
  selected.forEach(it=>{
    const name = it.name.toLowerCase();
    if (/bread butter|toast/i.test(name)) {
      details.push("Swap white bread for wholegrain or add peanut butter for protein.");
    }
    if (/oats/i.test(name)) {
      details.push("Oats are great — keep them unsweetened; top with a few nuts for protein.");
    }
    if (/poha|upma|idli|dosa|paratha|aloo/i.test(name)) {
      details.push("These are good staples — pair with curd or a vegetable side to add protein and fiber.");
    }
    if (/banana|apple|fruit/i.test(name)) {
      details.push("If you picked fruit, eat it with a handful of nuts to slow sugar absorption.");
    }
    if (/chai/i.test(name)) {
      details.push("Ask for 'less sugar' in chai or use jaggery as a lower-GI alternative in small amounts.");
    }
  });

  // 3) Quick practical rules (prioritized)
  const practical = [];
  if (total > 30) {
    practical.push("Reduce or remove the highest-sugar item on your plate.");
    practical.push("Prefer unsweetened tea/coffee and water.");
    practical.push("Add a protein source now (curd, paneer, egg) to blunt the spike.");
  } else if (total < 5 && total > 0) {
    practical.push("Add one small carb + protein (e.g., milk + banana or bread + peanut butter).");
    practical.push("Avoid high-sugar snacks; choose whole foods.");
  } else {
    practical.push("Maintain this balance: carbs + some protein + fiber.");
    practical.push("Keep added sugar < 10 g per meal when possible.");
  }

  // 4) Limit repetition by picking a few unique messages
  function uniqueFirst(arr, max=4){
    const seen = new Set();
    const out = [];
    for(const x of arr){
      const t = x.replace(/<[^>]*>/g,'').trim().toLowerCase();
      if(!seen.has(t)){
        seen.add(t);
        out.push(x);
        if(out.length>=max) break;
      }
    }
    return out;
  }

  const finalSuggestions = uniqueFirst(suggestions.concat(practical), 4);
  const finalDetails = uniqueFirst(details, 6);

  // Render recommendations
  const html = [];
  html.push(`<div style="margin-bottom:8px">${finalSuggestions.map(s=>`<p>${s}</p>`).join('')}</div>`);
  if(finalDetails.length){
    html.push(`<details style="background:#fff;padding:10px;border-radius:8px"><summary style="font-weight:700;cursor:pointer">More tips & swaps</summary><div style="margin-top:8px">${finalDetails.map(d=>`<p style="margin:6px 0">${d}</p>`).join('')}</div></details>`);
  }

  // Helpful quick facts block
  html.push(`<div style="margin-top:10px;color:#555;font-size:14px"><strong>Total sugar:</strong> ${formatG(total)} &nbsp; • &nbsp; Items: ${selected.length}</div>`);

  recoBody.innerHTML = html.join('');
  document.getElementById("recommendations").style.display = "block";
}


/* -------------------------
   EVENT LISTENERS
---------------------------*/
recoBtn.addEventListener('click', generateAIRecommendations);
resetBtn.addEventListener('click', ()=>{
  selected = [];
  renderPlate();
  reco.style.display = "none";
});

/* Initial render */
renderPlate();
</script>



<div id="alertOverlay" style="
  position: fixed;
  inset: 0;
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 40px;
  font-weight: 900;
  color: #ffffff;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.5s ease;
  z-index: 9999;
">
  <div id="alertMessage"></div>
</div>

</body>
</html>